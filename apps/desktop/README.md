# Tachybase Desktop Application

Mac æ¡Œé¢åº”ç”¨ï¼ŒåŸºäº Electron æ„å»ºã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
apps/desktop/
â”œâ”€â”€ electron/              # Electron ä¸»è¿›ç¨‹ä»£ç 
â”‚   â”œâ”€â”€ main.ts           # ä¸»è¿›ç¨‹å…¥å£
â”‚   â”œâ”€â”€ preload.ts        # é¢„åŠ è½½è„šæœ¬
â”‚   â””â”€â”€ tsconfig.json     # TypeScript é…ç½®
â”œâ”€â”€ build/                # æ„å»ºèµ„æº
â”‚   â””â”€â”€ entitlements.mac.plist  # macOS æƒé™é…ç½®
â”œâ”€â”€ electron-builder.config.js   # æ‰“åŒ…é…ç½®
â””â”€â”€ package.json          # é¡¹ç›®é…ç½®
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆæ¨èï¼‰
pnpm install

# æˆ–ä»…å®‰è£… desktop ä¾èµ–
cd apps/desktop
pnpm install
```

### å¼€å‘æ¨¡å¼

**æ–¹å¼ä¸€ï¼šä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼ˆæ¨èï¼‰**

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
pnpm dev:desktop
# æˆ–
pnpm desktop:dev
```

**æ–¹å¼äºŒï¼šä» desktop ç›®å½•è¿è¡Œ**

```bash
cd apps/desktop
pnpm dev
```

è¿™ä¸ªå‘½ä»¤ä¼šï¼š
1. å¯åŠ¨ `apps/web` çš„å¼€å‘æœåŠ¡å™¨ï¼ˆé»˜è®¤ç«¯å£ 31000ï¼Œå¯é€šè¿‡ `WEB_PORT` ç¯å¢ƒå˜é‡è¦†ç›–ï¼‰
2. ç­‰å¾…æœåŠ¡å™¨å°±ç»ªåå¯åŠ¨ Electron çª—å£

**ç«¯å£é…ç½®**ï¼š
- é»˜è®¤ç«¯å£ï¼š`31000`ï¼ˆé¿å…ä¸å¸¸ç”¨ç«¯å£å†²çªï¼‰
- **ç«¯å£æ£€æŸ¥**ï¼šå¯åŠ¨å‰ä¼šè‡ªåŠ¨æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼Œå¦‚æœè¢«å ç”¨ä¼šç›´æ¥å¤±è´¥å¹¶æç¤º
- å¯é€šè¿‡ç¯å¢ƒå˜é‡è‡ªå®šä¹‰ï¼š`WEB_PORT=3000 pnpm desktop:dev`

### æ„å»ºå’Œæ‰“åŒ…

**ä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼ˆæ¨èï¼‰**ï¼š

```bash
# å¼€å‘æ¨¡å¼
pnpm desktop:dev

# æ„å»º Electron ä¸»è¿›ç¨‹
pnpm desktop:build

# æ‰“åŒ…ä¸º Mac åº”ç”¨
pnpm desktop:dist:mac

# æ‰“åŒ…æ‰€æœ‰å¹³å°
pnpm desktop:dist
```

**ä» desktop ç›®å½•è¿è¡Œ**ï¼š

```bash
cd apps/desktop

# 1. æ„å»º Electron ä¸»è¿›ç¨‹
pnpm build

# 2. æ„å»º Web åº”ç”¨ï¼ˆä¼šè‡ªåŠ¨è°ƒç”¨ï¼‰
pnpm build:web

# 3. æ‰“åŒ…ä¸º Mac åº”ç”¨
pnpm dist:mac
```

æ‰“åŒ…åçš„æ–‡ä»¶ä½äº `apps/desktop/release/` ç›®å½•ã€‚

## ğŸ“ è„šæœ¬è¯´æ˜

- `dev` - å¼€å‘æ¨¡å¼ï¼ˆåŒæ—¶å¯åŠ¨ Web å’Œ Electronï¼‰
- `build` - æ„å»º Electron ä¸»è¿›ç¨‹
- `build:web` - æ„å»º Web åº”ç”¨
- `electron` - ç›´æ¥è¿è¡Œ Electronï¼ˆéœ€è¦å…ˆæ„å»ºï¼‰
- `electron:dev` - å¼€å‘æ¨¡å¼è¿è¡Œ Electron
- `pack` - æ‰“åŒ…æµ‹è¯•ï¼ˆä¸ç”Ÿæˆå®‰è£…åŒ…ï¼‰
- `dist` - æ‰“åŒ…æ‰€æœ‰å¹³å°
- `dist:mac` - ä»…æ‰“åŒ… Mac å¹³å°

## ğŸ”§ é…ç½®è¯´æ˜

### ä¸»è¿›ç¨‹é…ç½® (`electron/main.ts`)

- **çª—å£å¤§å°**: é»˜è®¤ 1200x800ï¼Œæœ€å° 800x600
- **å¼€å‘ç¯å¢ƒ**: è¿æ¥åˆ° `apps/web` çš„å¼€å‘æœåŠ¡å™¨
- **ç”Ÿäº§ç¯å¢ƒ**: åŠ è½½ `apps/web/dist` çš„æ„å»ºäº§ç‰©

### æ‰“åŒ…é…ç½® (`electron-builder.config.js`)

- **åº”ç”¨ ID**: `com.tachybase.app`
- **äº§å“åç§°**: `Tachybase`
- **æ”¯æŒæ¶æ„**: x64 å’Œ arm64ï¼ˆApple Siliconï¼‰

## ğŸ“¦ ä¾èµ–å…³ç³»

æ¡Œé¢åº”ç”¨ä¾èµ–äº `apps/web` çš„æ„å»ºäº§ç‰©å’Œåç«¯æœåŠ¡å™¨ï¼š

1. **å¼€å‘ç¯å¢ƒ**: é€šè¿‡ HTTP è¿æ¥åˆ° Web å¼€å‘æœåŠ¡å™¨
2. **ç”Ÿäº§ç¯å¢ƒ**: 
   - Web æ„å»ºäº§ç‰©é€šè¿‡ `electron-builder` çš„ `extraResources` è‡ªåŠ¨ä» `apps/web/dist` åŒ…å«
   - åç«¯æœåŠ¡å™¨é€šè¿‡ `pnpm install --prod` åœ¨ä¸´æ—¶ç›®å½•å‡†å¤‡ï¼Œç„¶åç”± `electron-builder` è‡ªåŠ¨åŒ…å«
   - æ‰€æœ‰èµ„æºæ–‡ä»¶ç”± `electron-builder` è‡ªåŠ¨å¤„ç†ï¼Œæ— éœ€æ‰‹åŠ¨å¤åˆ¶

## ğŸ¯ æ¶æ„ä¼˜åŠ¿

âœ… **å…³æ³¨ç‚¹åˆ†ç¦»**: Web å’Œ Desktop åº”ç”¨ç‹¬ç«‹ç®¡ç†  
âœ… **ä»£ç å¤ç”¨**: å…±äº« Web åº”ç”¨çš„æ„å»ºäº§ç‰©  
âœ… **ç‹¬ç«‹å¼€å‘**: å¯ä»¥ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•æ¡Œé¢åŠŸèƒ½  
âœ… **æ¸…æ™°ç»“æ„**: ç¬¦åˆ monorepo æœ€ä½³å®è·µ  

## ğŸ“‹ æ—¥å¿—æŸ¥çœ‹

æ‰“åŒ…åçš„åº”ç”¨ä¼šè‡ªåŠ¨å°†æ—¥å¿—å†™å…¥æ–‡ä»¶ï¼š

**macOS:**
```bash
~/Library/Logs/@tego/desktop/tachybase.log
```

**æŸ¥çœ‹æ—¥å¿—ï¼š**
```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f ~/Library/Logs/@tego/desktop/tachybase.log

# æŸ¥çœ‹æœ€å 100 è¡Œ
tail -n 100 ~/Library/Logs/@tego/desktop/tachybase.log
```

**ä»ç»ˆç«¯å¯åŠ¨åº”ç”¨æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼š**
```bash
/Applications/Tachybase.app/Contents/MacOS/Tachybase
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ„å»ºé¡ºåº**: æ‰“åŒ…å‰éœ€è¦å…ˆæ„å»º Web åº”ç”¨ï¼ˆ`pnpm build:web`ï¼‰
2. **è·¯å¾„é…ç½®**: ç”Ÿäº§ç¯å¢ƒçš„è·¯å¾„ä¼šè‡ªåŠ¨å¤„ç†
3. **å›¾æ ‡æ–‡ä»¶**: éœ€è¦å‡†å¤‡ `build/icon.icns` æ–‡ä»¶
4. **åç«¯æœåŠ¡å™¨**: 
   - æ‰“åŒ…æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œ `pnpm install --prod` å‡†å¤‡åç«¯ä¾èµ–
   - ç”Ÿäº§ç¯å¢ƒä¼šè‡ªåŠ¨å¯åŠ¨åç«¯æœåŠ¡å™¨ï¼ˆä»åº”ç”¨åŒ…å†…çš„ `Resources/backend` å¯åŠ¨ï¼‰
5. **è‡ªåŠ¨åŒ–æ‰“åŒ…**: ä½¿ç”¨ `electron-builder` çš„ `files` å’Œ `extraResources` é…ç½®è‡ªåŠ¨å¤„ç†æ‰€æœ‰èµ„æºæ–‡ä»¶ï¼Œæ— éœ€æ‰‹åŠ¨å¤åˆ¶è„šæœ¬

